"use strict";angular.module("shm.youtube",[]).directive("youtube",["YoutubeAPI","$timeout",function(YoutubeAPI,$timeout){return{template:"<div></div>",restrict:"E",replace:!0,scope:{video:"@"},link:function(scope,element,attrs){var player;if(!attrs.video)throw new Error("Youtube directive: missing video attribute.");attrs.mercy=attrs.mercy||333,attrs.width=attrs.width||"100%",attrs.width=-1===attrs.width.indexOf("%")?attrs.width+"px":attrs.width,attrs.height=attrs.height||"100%",attrs.height=-1===attrs.height.indexOf("%")?attrs.height+"px":attrs.height,element.attr("id",attrs.video).css("height",attrs.height).css("width",attrs.width).attr("class",attrs["class"]),element.css("background","url(https://s.ytimg.com/yts/img/icn_loading_animated-vflff1Mjj.gif) center black no-repeat"),YoutubeAPI.loadBinary(function(){$timeout(function(){player=new YT.Player(attrs.video,{height:attrs.height,width:attrs.width,videoId:attrs.video})},attrs.mercy)}),scope.$on("$destroy",function(){player.destroy(),player=null})}}}]).service("YoutubeAPI",["$window",function($window){var loaded=0,callbacks=[];this.loadBinary=function(cb){if(2===loaded)return void cb();if(1===loaded)return void callbacks.push(cb);callbacks.push(cb),loaded=1;var tag=document.createElement("script");tag.src="https://www.youtube.com/iframe_api";var firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag),$window.onYouTubeIframeAPIReady=this._apiReady},this._apiReady=function(){loaded=2,callbacks.forEach(function(cb){cb()}),callbacks.length=0,callbacks=null,delete $window.onYouTubeIframeAPIReady}}]);